import json
import argparse
import os

parser = argparse.ArgumentParser()
parser.add_argument("--mode", "-m", default = 0, type = int, help = "The mode of reading sourceure file.")
parser.add_argument("--file", "-f", default = None, help = "The name of the file.")
parser.add_argument("--url", "-u", default = None, help = "The sharing link.")
parser.add_argument("--delay", "-d", default = None, type = int, help = "The dealy time.")

args = parser.parse_args()

with open("../config/source.json",'r') as source_file:
	source = json.load(source_file)
	folder = "../public/articles/"
	if args.delay is None:
		delay = source['delay']
	else:
		delay = args.delay

	if args.mode==0:
		if args.file is None:
			if not os.path.exists(os.path.join(r"../public/articles/",source['file'])):
				os.makedirs(os.path.join(r"../public/articles/",source['file']))
			file = os.path.join(folder, source['file'], 'index.html')
		else:
			if not os.path.exists(os.path.join(r"../public/articles/",args.file)):
				os.makedirs(os.path.join(r"../public/articles/",args.file))
			file = os.path.join(folder, args.file, 'index.html')
		if args.url is None:
			url = source['url']
		else: 
			url = args.url

	else:
         if (args.file is not None) or (args.url is not None):
             raise Exception("Invaild argument!")
         elif len(source['file'])!=len(source['url']):
             raise Exception("number of files and urls is not equal!")
         else:
             file = []
             for x in source['file']:
                 if not os.path.exists(os.path.join(r"../public/articles/",x)):
                     os.makedirs(os.path.join(r"../public/articles/",x))
                 file.append(os.path.join(folder, x, 'index.html'))
                 url = [y for y in source['url']]

'''
http://www.html5tricks.com/tag/html5%E5%8A%A8%E7%94%BB
'''
if args.mode==0:
	with open(file, 'w') as f:
		f.write("<!DOCTYPE html><html><head><meta charset='UTF-8'><meta HTTP-EQUIV='refresh' content='%d;url=%s'></head><body><br><br><br><div class='loader'><div class='loader_overlay'></div><div class='loader_cogs'><div class='loader_cogs__top'><div class='top_part'></div><div class='top_part'></div><div class='top_part'></div><div class='top_hole'></div></div><div class='loader_cogs__left'><div class='left_part'></div><div class='left_part'></div><div class='left_part'></div><div class='left_hole'></div></div><div class='loader_cogs__bottom'><div class='bottom_part'></div><div class='bottom_part'></div><div class='bottom_part'></div><div class='bottom_hole'></div></div><p>loading</p></div></div><div style='text-align:center;clear:both;'></div></body></html><style>@charset 'utf-8';body{height:100vh;text-align:center;overflow:hidden}body h1{text-transform:uppercase;font-size:30px;color:#576e81;margin:30px 0 0 0}body h2{font-weight:normal;font-size:18px;color:#f98db9;margin:10px 0 0 0}body p{margin:0 auto}body .loader{height:250px;position:relative;margin:auto;width:400px;z-index:10}body .loader_overlay{width:150px;height:150px;background:transparent;box-shadow:0 0 0 1000px rgba(255,255,255,0.67),0px 0 19px 0 rgba(0,0,0,0.16) inset;border-radius:100%%;z-index:-1;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}body .loader_cogs{z-index:-2;width:100px;height:100px;top:-120px!important;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}body .loader_cogs__top{position:relative;width:100px;height:100px;-webkit-transform-origin:50px 50px;transform-origin:50px 50px;-webkit-animation:rotate 10s infinite linear;animation:rotate 10s infinite linear}body .loader_cogs__top div:nth-of-type(1){-webkit-transform:rotate(30deg);transform:rotate(30deg)}body .loader_cogs__top div:nth-of-type(2){-webkit-transform:rotate(60deg);transform:rotate(60deg)}body .loader_cogs__top div:nth-of-type(3){-webkit-transform:rotate(90deg);transform:rotate(90deg)}body .loader_cogs__top div.top_part{width:100px;border-radius:10px;position:absolute;height:100px;background:#f98db9}body .loader_cogs__top div.top_hole{width:50px;height:50px;border-radius:100%%;background:white;position:absolute;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}body .loader_cogs__left{position:relative;width:80px;-webkit-transform:rotate(16deg);transform:rotate(16deg);top:28px;-webkit-transform-origin:40px 40px;transform-origin:40px 40px;-webkit-animation:rotate_left 10s .1s infinite reverse linear;animation:rotate_left 10s .1s infinite reverse linear;left:-24px;height:80px}body .loader_cogs__left div:nth-of-type(1){-webkit-transform:rotate(30deg);transform:rotate(30deg)}body .loader_cogs__left div:nth-of-type(2){-webkit-transform:rotate(60deg);transform:rotate(60deg)}body .loader_cogs__left div:nth-of-type(3){-webkit-transform:rotate(90deg);transform:rotate(90deg)}body .loader_cogs__left div.left_part{width:80px;border-radius:6px;position:absolute;height:80px;background:#97ddff}body .loader_cogs__left div.left_hole{width:40px;height:40px;border-radius:100%%;background:white;position:absolute;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}body .loader_cogs__bottom{position:relative;width:60px;top:-65px;-webkit-transform-origin:30px 30px;transform-origin:30px 30px;-webkit-animation:rotate_left 10.2s .4s infinite linear;animation:rotate_left 10.2s .4s infinite linear;-webkit-transform:rotate(4deg);transform:rotate(4deg);left:79px;height:60px}body .loader_cogs__bottom div:nth-of-type(1){-webkit-transform:rotate(30deg);transform:rotate(30deg)}body .loader_cogs__bottom div:nth-of-type(2){-webkit-transform:rotate(60deg);transform:rotate(60deg)}body .loader_cogs__bottom div:nth-of-type(3){-webkit-transform:rotate(90deg);transform:rotate(90deg)}body .loader_cogs__bottom div.bottom_part{width:60px;border-radius:5px;position:absolute;height:60px;background:#ffcd66}body .loader_cogs__bottom div.bottom_hole{width:30px;height:30px;border-radius:100%%;background:white;position:absolute;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes rotate_left{from{-webkit-transform:rotate(16deg);transform:rotate(16deg)}to{-webkit-transform:rotate(376deg);transform:rotate(376deg)}}@keyframes rotate_left{from{-webkit-transform:rotate(16deg);transform:rotate(16deg)}to{-webkit-transform:rotate(376deg);transform:rotate(376deg)}}@-webkit-keyframes rotate_right{from{-webkit-transform:rotate(4deg);transform:rotate(4deg)}to{-webkit-transform:rotate(364deg);transform:rotate(364deg)}}@keyframes rotate_right{from{-webkit-transform:rotate(4deg);transform:rotate(4deg)}to{-webkit-transform:rotate(364deg);transform:rotate(364deg)}}</style>"%(delay, url))
else:
	length = len(file)
	for i in range(length):
		with open(file[i], 'w') as f:
			f.write("<!DOCTYPE html><html><head><meta charset='UTF-8'><meta HTTP-EQUIV='refresh' content='%d;url=%s'></head><body><br><br><br><div class='loader'><div class='loader_overlay'></div><div class='loader_cogs'><div class='loader_cogs__top'><div class='top_part'></div><div class='top_part'></div><div class='top_part'></div><div class='top_hole'></div></div><div class='loader_cogs__left'><div class='left_part'></div><div class='left_part'></div><div class='left_part'></div><div class='left_hole'></div></div><div class='loader_cogs__bottom'><div class='bottom_part'></div><div class='bottom_part'></div><div class='bottom_part'></div><div class='bottom_hole'></div></div><p>loading</p></div></div><div style='text-align:center;clear:both;'></div></body></html><style>@charset 'utf-8';body{height:100vh;text-align:center;overflow:hidden}body h1{text-transform:uppercase;font-size:30px;color:#576e81;margin:30px 0 0 0}body h2{font-weight:normal;font-size:18px;color:#f98db9;margin:10px 0 0 0}body p{margin:0 auto}body .loader{height:250px;position:relative;margin:auto;width:400px;z-index:10}body .loader_overlay{width:150px;height:150px;background:transparent;box-shadow:0 0 0 1000px rgba(255,255,255,0.67),0px 0 19px 0 rgba(0,0,0,0.16) inset;border-radius:100%%;z-index:-1;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}body .loader_cogs{z-index:-2;width:100px;height:100px;top:-120px!important;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}body .loader_cogs__top{position:relative;width:100px;height:100px;-webkit-transform-origin:50px 50px;transform-origin:50px 50px;-webkit-animation:rotate 10s infinite linear;animation:rotate 10s infinite linear}body .loader_cogs__top div:nth-of-type(1){-webkit-transform:rotate(30deg);transform:rotate(30deg)}body .loader_cogs__top div:nth-of-type(2){-webkit-transform:rotate(60deg);transform:rotate(60deg)}body .loader_cogs__top div:nth-of-type(3){-webkit-transform:rotate(90deg);transform:rotate(90deg)}body .loader_cogs__top div.top_part{width:100px;border-radius:10px;position:absolute;height:100px;background:#f98db9}body .loader_cogs__top div.top_hole{width:50px;height:50px;border-radius:100%%;background:white;position:absolute;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}body .loader_cogs__left{position:relative;width:80px;-webkit-transform:rotate(16deg);transform:rotate(16deg);top:28px;-webkit-transform-origin:40px 40px;transform-origin:40px 40px;-webkit-animation:rotate_left 10s .1s infinite reverse linear;animation:rotate_left 10s .1s infinite reverse linear;left:-24px;height:80px}body .loader_cogs__left div:nth-of-type(1){-webkit-transform:rotate(30deg);transform:rotate(30deg)}body .loader_cogs__left div:nth-of-type(2){-webkit-transform:rotate(60deg);transform:rotate(60deg)}body .loader_cogs__left div:nth-of-type(3){-webkit-transform:rotate(90deg);transform:rotate(90deg)}body .loader_cogs__left div.left_part{width:80px;border-radius:6px;position:absolute;height:80px;background:#97ddff}body .loader_cogs__left div.left_hole{width:40px;height:40px;border-radius:100%%;background:white;position:absolute;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}body .loader_cogs__bottom{position:relative;width:60px;top:-65px;-webkit-transform-origin:30px 30px;transform-origin:30px 30px;-webkit-animation:rotate_left 10.2s .4s infinite linear;animation:rotate_left 10.2s .4s infinite linear;-webkit-transform:rotate(4deg);transform:rotate(4deg);left:79px;height:60px}body .loader_cogs__bottom div:nth-of-type(1){-webkit-transform:rotate(30deg);transform:rotate(30deg)}body .loader_cogs__bottom div:nth-of-type(2){-webkit-transform:rotate(60deg);transform:rotate(60deg)}body .loader_cogs__bottom div:nth-of-type(3){-webkit-transform:rotate(90deg);transform:rotate(90deg)}body .loader_cogs__bottom div.bottom_part{width:60px;border-radius:5px;position:absolute;height:60px;background:#ffcd66}body .loader_cogs__bottom div.bottom_hole{width:30px;height:30px;border-radius:100%%;background:white;position:absolute;position:absolute;left:0;right:0;top:0;bottom:0;margin:auto}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes rotate_left{from{-webkit-transform:rotate(16deg);transform:rotate(16deg)}to{-webkit-transform:rotate(376deg);transform:rotate(376deg)}}@keyframes rotate_left{from{-webkit-transform:rotate(16deg);transform:rotate(16deg)}to{-webkit-transform:rotate(376deg);transform:rotate(376deg)}}@-webkit-keyframes rotate_right{from{-webkit-transform:rotate(4deg);transform:rotate(4deg)}to{-webkit-transform:rotate(364deg);transform:rotate(364deg)}}@keyframes rotate_right{from{-webkit-transform:rotate(4deg);transform:rotate(4deg)}to{-webkit-transform:rotate(364deg);transform:rotate(364deg)}}</style>"%(delay, url[i]))